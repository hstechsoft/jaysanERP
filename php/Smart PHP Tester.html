<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart PHP Tester (Manual Code)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 150px; font-family: monospace; }
    input[type="text"] { padding: 5px; width: 220px; margin: 3px 0; }
    #params input { display: block; }
    #response { border: 1px solid #ccc; padding: 10px; margin-top: 20px; white-space: pre-wrap; background: #f8f8f8; max-height: 400px; overflow: auto; }
    pre.json { background: #1e1e1e; color: #d4d4d4; padding: 10px; border-radius: 5px; overflow-x: auto; }
    .key { color: #9cdcfe; }
    .string { color: #ce9178; }
    .number { color: #b5cea8; }
    .boolean { color: #569cd6; }
    .null { color: #808080; font-style: italic; }
  </style>
</head>
<body>
  <h2>Smart PHP Tester</h2>

  <label>PHP File URL:</label><br>
  <input type="text" id="phpFile" value="http://localhost/emp_menu.php"><br><br>

  <label>Paste Your PHP Code Below:</label><br>
  <textarea id="phpCode"></textarea><br>
  <button onclick="parseParams()">Generate Form</button><br><br>

  <form id="phpTester" style="display:none;">
    <div id="params"></div>
    <button type="submit">Send Request</button>
  </form>

  <h3>Response:</h3>
  <div id="response">Waiting for request...</div>

  <script>
    function parseParams() {
      const code = document.getElementById("phpCode").value;
      const paramSet = new Set();
      const getRegex = /\$_GET\[['"]([^'"]+)['"]\]/g;
      const postRegex = /\$_POST\[['"]([^'"]+)['"]\]/g;
      let match;
      let foundGet = false, foundPost = false;

      while ((match = getRegex.exec(code)) !== null) {
        paramSet.add(match[1]);
        foundGet = true;
      }
      while ((match = postRegex.exec(code)) !== null) {
        paramSet.add(match[1]);
        foundPost = true;
      }

      const paramsDiv = document.getElementById("params");
      paramsDiv.innerHTML = "";
      if (paramSet.size === 0) {
        paramsDiv.innerHTML = "<p><b>No parameters found in code.</b></p>";
      } else {
        paramSet.forEach(param => {
          paramsDiv.innerHTML += `<label>${param}:</label><br><input type="text" name="${param}"><br>`;
        });
      }

      document.getElementById("phpTester").dataset.method = foundPost ? "POST" : "GET";
      document.getElementById("phpTester").style.display = "block";
    }

    document.getElementById("phpTester").addEventListener("submit", async function(e) {
      e.preventDefault();

      const url = document.getElementById("phpFile").value;
      const method = document.getElementById("phpTester").dataset.method;
      const inputs = document.querySelectorAll("#params input");

      let params = new URLSearchParams();
      inputs.forEach(input => params.append(input.name, input.value));

      let finalUrl = url;
      let options = { method };

      if (method === "GET") {
        finalUrl += "?" + params.toString();
      } else {
        options.body = params;
        options.headers = { "Content-Type": "application/x-www-form-urlencoded" };
      }

      try {
        const response = await fetch(finalUrl, options);
        const text = await response.text();
        document.getElementById("response").innerHTML = formatResponse(text);
      } catch (err) {
        document.getElementById("response").textContent = "‚ùå Error: " + err;
      }
    });

    function formatResponse(text) {
      try {
        const json = JSON.parse(text);
        return "<pre class='json'>" + syntaxHighlight(JSON.stringify(json, null, 2)) + "</pre>";
      } catch (e) {
        return text;
      }
    }

    function syntaxHighlight(json) {
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(?:\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        let cls = 'number';
        if (/^"/.test(match)) {
          cls = /:$/.test(match) ? 'key' : 'string';
        } else if (/true|false/.test(match)) {
          cls = 'boolean';
        } else if (/null/.test(match)) {
          cls = 'null';
        }
        return `<span class="${cls}">${match}</span>`;
      });
    }
  </script>
</body>
</html>
